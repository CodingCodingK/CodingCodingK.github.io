<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>王者荣耀复刻项目 技能篇 | CodingCodingK Blog</title><meta name="keywords" content="Unity,工程,Moba"><meta name="author" content="CodingCodingK"><meta name="copyright" content="CodingCodingK"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="技能机制总览图 技能分析目标 &#x3D; 指向；弹道 &#x3D; 借助bullet；无前摇 &#x3D; 瞬发型。    英雄 亚瑟 后羿    普攻 目标技能 + 非弹道、有前摇 目标技能 + 弹道、延迟   技能1 非目标技能  buff替换普攻Cfg + 非弹道、无前摇    技能2 非目标技能 + 非弹道、无前摇    技能3 目标技能 + 非弹道、有前摇    非目标技能（非指向）1.buff替换普攻Cfg技能实">
<meta property="og:type" content="article">
<meta property="og:title" content="王者荣耀复刻项目 技能篇">
<meta property="og:url" content="https://codingcodingk.github.io/2021/12/18/Project/Unity/Moba/HOK/skill/index.html">
<meta property="og:site_name" content="CodingCodingK Blog">
<meta property="og:description" content="技能机制总览图 技能分析目标 &#x3D; 指向；弹道 &#x3D; 借助bullet；无前摇 &#x3D; 瞬发型。    英雄 亚瑟 后羿    普攻 目标技能 + 非弹道、有前摇 目标技能 + 弹道、延迟   技能1 非目标技能  buff替换普攻Cfg + 非弹道、无前摇    技能2 非目标技能 + 非弹道、无前摇    技能3 目标技能 + 非弹道、有前摇    非目标技能（非指向）1.buff替换普攻Cfg技能实">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg">
<meta property="article:published_time" content="2021-12-18T06:56:08.410Z">
<meta property="article:modified_time" content="2022-01-15T11:50:39.502Z">
<meta property="article:author" content="CodingCodingK">
<meta property="article:tag" content="Unity">
<meta property="article:tag" content="工程">
<meta property="article:tag" content="Moba">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/Seed_profile.png"><link rel="canonical" href="https://codingcodingk.github.io/2021/12/18/Project/Unity/Moba/HOK/skill/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '王者荣耀复刻项目 技能篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-15 19:50:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/mine.css"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="CodingCodingK Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/Seed_profile.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 专栏</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> CodingCodingK</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">CodingCodingK Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 专栏</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> CodingCodingK</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">王者荣耀复刻项目 技能篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-18T06:56:08.410Z" title="发表于 2021-12-18 14:56:08">2021-12-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-15T11:50:39.502Z" title="更新于 2022-01-15 19:50:39">2022-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Unity/Moba/">Moba</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Unity/Moba/%E7%8E%8B%E8%80%85%E8%8D%A3%E8%80%80%E5%A4%8D%E5%88%BB%E9%A1%B9%E7%9B%AE/">王者荣耀复刻项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="王者荣耀复刻项目 技能篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="技能机制"><a href="#技能机制" class="headerlink" title="技能机制"></a><Center>技能机制<Center/></h1><h2 id="总览图"><a href="#总览图" class="headerlink" title="总览图"></a>总览图</h2><p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20211206214406.png"></p>
<h2 id="技能分析"><a href="#技能分析" class="headerlink" title="技能分析"></a>技能分析</h2><p>目标 = 指向；弹道 = 借助bullet；无前摇 = 瞬发型。</p>
<table>
<thead>
<tr>
<th>英雄</th>
<th>亚瑟</th>
<th>后羿</th>
</tr>
</thead>
<tbody><tr>
<td>普攻</td>
<td>目标技能 + 非弹道、有前摇</td>
<td>目标技能 + 弹道、延迟</td>
</tr>
<tr>
<td>技能1</td>
<td>非目标技能  buff替换普攻Cfg + 非弹道、无前摇</td>
<td></td>
</tr>
<tr>
<td>技能2</td>
<td>非目标技能 + 非弹道、无前摇</td>
<td></td>
</tr>
<tr>
<td>技能3</td>
<td>目标技能 + 非弹道、有前摇</td>
<td></td>
</tr>
</tbody></table>
<h2 id="非目标技能（非指向）"><a href="#非目标技能（非指向）" class="headerlink" title="非目标技能（非指向）"></a>非目标技能（非指向）</h2><h3 id="1-buff替换普攻Cfg技能实现（亚瑟一技能）"><a href="#1-buff替换普攻Cfg技能实现（亚瑟一技能）" class="headerlink" title="1.buff替换普攻Cfg技能实现（亚瑟一技能）"></a>1.buff替换普攻Cfg技能实现（亚瑟一技能）</h3><p>亚瑟技能1有许多buff附加到下一个普攻上，直接修改普攻得buffArr使其变更数据会让代码复杂，所以直接采用技能替换普攻的方法，将其作为一个技能。</p>
<p>之后每1次普攻，其实就相当于在释放1次技能了，所以技能的buff 也会随着每一次普攻而重新Create。</p>
<p>直到时间结束或者攻击次数用完，技能被替换回原先的普攻。</p>
<h3 id="2-后裔三技能实现"><a href="#2-后裔三技能实现" class="headerlink" title="2.后裔三技能实现"></a>2.后裔三技能实现</h3><h2 id="目标技能（指向）"><a href="#目标技能（指向）" class="headerlink" title="目标技能（指向）"></a>目标技能（指向）</h2><h3 id="通用的寻找目标实现"><a href="#通用的寻找目标实现" class="headerlink" title="通用的寻找目标实现"></a>通用的寻找目标实现</h3><p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20211206220958.png"></p>
<ol>
<li>根据配置，查找到所有活着的可作为目标的单位(比如红队的英雄)</li>
<li>根据技能配置规则，确定最终目标单位(比如最近的单个英雄)</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------1.中的配置规则----------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 施法目标阵营</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> TargetTeamEnum</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用于动态选择目标，通常是方向指向或位置指向技能，在施法成功后通过buff选择目标</span></span><br><span class="line">    Dynamic,</span><br><span class="line">    Friend,</span><br><span class="line">    Enemy</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> 施法目标类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> UnitTypeEnum</span><br><span class="line">&#123;</span><br><span class="line">    Hero,</span><br><span class="line">    Soldier,</span><br><span class="line">    Tower,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------2.中的技能配置规则----------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> SelectRuleEnum</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 单个目标选择规则</span></span><br><span class="line">    </span><br><span class="line">    MinHpValue,<span class="comment">// 血量最小</span></span><br><span class="line">    MinHpPercent,<span class="comment">// 血量百分比最小</span></span><br><span class="line">    TargetClosestSingle,<span class="comment">// 最近的单个</span></span><br><span class="line">    PositionClosestSingle,<span class="comment">// 靠近某个位置的单个选择</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多个目标选择规则</span></span><br><span class="line">    </span><br><span class="line">    TargetClosestMulti,<span class="comment">// 最近的多个（范围选择）</span></span><br><span class="line">    PositionClosestMulti,<span class="comment">// 靠近某个位置的多个选择（范围选择）</span></span><br><span class="line">    </span><br><span class="line">    Hero,<span class="comment">// 所有英雄单位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后让我们看一下2中实现目标查找的关键部分代码，找最近单体目标的核心代码。其他的实现比如查找符合目标的群体算法，核心部分逻辑也是一样的：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------核心，查找规则----------------</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> MainLogicUnit <span class="title">FindMinDisTarget</span>(<span class="params">MainLogicUnit self,List&lt;MainLogicUnit&gt; targetList, PEInt range</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (targetList == <span class="literal">null</span> || targetList.Count &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MainLogicUnit target = <span class="literal">null</span>;</span><br><span class="line">    PEVector3 selfPos = self.LogicPos;</span><br><span class="line">    PEInt len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; targetList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        PEInt sumRaius = targetList[i].ud.unitCfg.colliCfg.mRadius + self.ud.unitCfg.colliCfg.mRadius;</span><br><span class="line">        <span class="comment">// 要剔除掉半径，因为某单位半径可能因为体型变大而变得非常大，结果就看上去更近了，应该打这个看上去更近的</span></span><br><span class="line">        <span class="comment">// 可以优化一下 =&gt; 模magnitude 用 平方根sqrMagnitude替代，比较的时候与(range + sumRaius)*(range + sumRaius)比较即可，不等式是一样的，但可以省去一次开根号。</span></span><br><span class="line">        PEInt tmpLen = (targetList[i].LogicPos - selfPos).magnitude - sumRaius;</span><br><span class="line">        <span class="keyword">if</span> (target == <span class="literal">null</span> || tmpLen &lt; len)</span><br><span class="line">        &#123;</span><br><span class="line">            len = tmpLen;</span><br><span class="line">            target = targetList[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将上面找到的最近目标与range比较，如果还是超过range就返回null</span></span><br><span class="line">    <span class="keyword">return</span> len &lt; range ? target : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="1-亚瑟普攻实现"><a href="#1-亚瑟普攻实现" class="headerlink" title="1.亚瑟普攻实现"></a>1.亚瑟普攻实现</h3><ol>
<li>寻找目标</li>
<li>切换技能状态到<code>SKillState.SpellStart</code></li>
<li>播放音效</li>
<li>修改朝向：修改为<code>lockTarget.LogicPos - owner.LogicPos</code>的PEVector3向量。</li>
<li>播放动画：先取消移动，再播放攻击动画。</li>
</ol>
<h3 id="2-后裔普攻实现"><a href="#2-后裔普攻实现" class="headerlink" title="2.后裔普攻实现"></a>2.后裔普攻实现</h3><h1 id="技能构造"><a href="#技能构造" class="headerlink" title="技能构造"></a><Center>技能构造<Center/></h1><h2 id="技能Config"><a href="#技能Config" class="headerlink" title="技能Config"></a>技能Config</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>






<h1 id="血条和伤害UI"><a href="#血条和伤害UI" class="headerlink" title="血条和伤害UI"></a><Center>血条和伤害UI<Center/></h1><h2 id="血条-数据结构"><a href="#血条-数据结构" class="headerlink" title="血条 数据结构"></a>血条 数据结构</h2><p><strong>个体状态枚举类</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 血条上显示的状态</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> StateEnum</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    Silenced,<span class="comment">//沉默</span></span><br><span class="line">    Knockup,<span class="comment">//击飞</span></span><br><span class="line">    Stunned,<span class="comment">//眩晕</span></span><br><span class="line">    </span><br><span class="line">    Invincible,<span class="comment">//无敌</span></span><br><span class="line">    Restricted,<span class="comment">//禁锢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>抽象血条类结构</strong></p>
<p>继承关系：公用抽象血条类 =&gt; 塔 ； 公用抽象血条类 =&gt; 小兵 =&gt; 英雄 </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> RectTransform rect;</span><br><span class="line"><span class="keyword">public</span> Image imgPrg;<span class="comment">// 进度</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">bool</span> isFriend;<span class="comment">//是否是友军，用来显示不同颜色的血条UI</span></span><br><span class="line"><span class="keyword">protected</span> Transform rootTrans;<span class="comment">//目标血条，即需要映射的物体的位置，比如英雄头顶上的位置</span></span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">int</span> hpVal;</span><br></pre></td></tr></table></figure>



<h2 id="UI映射"><a href="#UI映射" class="headerlink" title="UI映射"></a>UI映射</h2><p><strong>血条</strong></p>
<p><strong>血条映射</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (rootTrans)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="comment">// 标准高度：自适应高度，取出比例</span></span><br><span class="line">         <span class="built_in">float</span> scaleRate = <span class="number">1.0f</span> * ClientConfig.ScreenStandardHeight / Screen.height;</span><br><span class="line">         <span class="keyword">var</span> screenPos = Camera.main.WorldToScreenPoint(rootTrans.position);</span><br><span class="line">         rect.anchoredPosition = screenPos * scaleRate;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="伤害飘字-数据结构"><a href="#伤害飘字-数据结构" class="headerlink" title="伤害飘字 数据结构"></a>伤害飘字 数据结构</h2><p><strong>缓存池</strong></p>
<p>需要用到伤害飘字的单位比较多，频繁销毁创建会消耗性能，所以首先建立一个缓存池，限制个数为50，用到的时候从池中取出播放动画。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**跳字类型枚举类**</span><br><span class="line"></span><br><span class="line">```csharp</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> JumpTypeEnum</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    SkillDamage,</span><br><span class="line">    BuffDamage,</span><br><span class="line">    Cure,<span class="comment">// 治疗</span></span><br><span class="line">    SlowSpeed,<span class="comment">// 减速</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>跳字动画枚举类</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> JumpAniEnum</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    LeftCurve,<span class="comment">// 左曲线飘出</span></span><br><span class="line">    RightCurve,<span class="comment">// 右曲线飘出</span></span><br><span class="line">    CenterUp,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>飘字预制体脚本 结构</strong></p>
<p>全部公开，方便在unity面板内调参</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JumpNum</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> RectTransform rect;</span><br><span class="line">    <span class="keyword">public</span> Animator ani;</span><br><span class="line">    <span class="keyword">public</span> Text txt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MaxFont;<span class="comment">// 最大字体，比如60</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MinFont;<span class="comment">// 最小字体，比如40</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MaxFontValue;<span class="comment">// 将伤害转化为字体大小的计算值x，举例：伤害刚好=x，字体大小就取50</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Color skillDamageColor;</span><br><span class="line">    <span class="keyword">public</span> Color buffDamageColor;</span><br><span class="line">    <span class="keyword">public</span> Color cureDamageColor;</span><br><span class="line">    <span class="keyword">public</span> Color slowDamageColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="通用技能定时器"><a href="#通用技能定时器" class="headerlink" title="通用技能定时器"></a><Center>通用技能定时器<Center/></h1><h2 id="总体流程"><a href="#总体流程" class="headerlink" title="总体流程"></a>总体流程</h2><p>用于CD计时器。一共分3个部分：延迟、回调函数(循环)执行、结束回调(1次or不)执行。</p>
<h2 id="定时器代码"><a href="#定时器代码" class="headerlink" title="定时器代码"></a>定时器代码</h2><p>只展示<strong>重要成员</strong>和使用的<strong>接口</strong>，内部直接看代码（在github开源了）。</p>
<p>回调函数和3个部分的回调签名：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.回调函数，用于显示次数进度。参数：loopCounter</span></span><br><span class="line"><span class="keyword">private</span> Action&lt;<span class="built_in">int</span>&gt; cbAction;</span><br><span class="line"><span class="comment">// 循环累计次数</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> loopCounter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.回调函数，用于显示百分比进度。参数：是不是延迟的部分,prgLoopRate,prgAllRate</span></span><br><span class="line"><span class="keyword">private</span> Action&lt;<span class="built_in">bool</span>, <span class="built_in">float</span>, <span class="built_in">float</span>&gt; prgAction;</span><br><span class="line"><span class="comment">// 当前阶段(延迟or回调执行)进度</span></span><br><span class="line"><span class="built_in">float</span> prgLoopRate = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 计时器总体进度</span></span><br><span class="line"><span class="built_in">float</span> prgAllRate = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.结束后回调函数</span></span><br><span class="line"><span class="keyword">private</span> Action endAction;</span><br></pre></td></tr></table></figure>

<p>对外接口（构造器）：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MonoTimer</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    Action&lt;<span class="built_in">int</span>&gt; cbAction,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">float</span> intervalTime,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">int</span> loopCount = <span class="number">1</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    Action&lt;<span class="built_in">bool</span>, <span class="built_in">float</span>, <span class="built_in">float</span>&gt; prgAction = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    Action endAction = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">float</span> delayTime = <span class="number">0</span></span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">this</span>.IsActive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.prgAllTime = delayTime + intervalTime * loopCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="定时器测试示例"><a href="#定时器测试示例" class="headerlink" title="定时器测试示例"></a>定时器测试示例</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClickTestBtn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    SetText(txtTime, <span class="number">5</span>);</span><br><span class="line">    testTimer?.DisableTimer();</span><br><span class="line">    testTimer = CreateMonoTimer(</span><br><span class="line">        (loopCount) =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.ColorLog(LogColor.Green, <span class="string">&quot;Loop:&quot;</span> + loopCount);</span><br><span class="line">            SetText(txtTime, <span class="number">5</span> - loopCount);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">1000</span>,</span><br><span class="line">        <span class="number">5</span>,</span><br><span class="line">        (isDelay, loopPrg, allPrg) =&gt; &#123;</span><br><span class="line">            SetActive(imgPrgLoop);</span><br><span class="line">            <span class="keyword">if</span>(isDelay) &#123;</span><br><span class="line">                SetActive(txtTime, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                SetActive(txtTime);</span><br><span class="line">            &#125;</span><br><span class="line">            imgPrgLoop.fillAmount = <span class="number">1</span> - loopPrg;</span><br><span class="line">            imgPrgAll.fillAmount = allPrg;</span><br><span class="line">        &#125;,</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            SetActive(imgPrgLoop, <span class="literal">false</span>);</span><br><span class="line">            imgPrgAll.fillAmount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">this</span>.ColorLog(LogColor.Green, <span class="string">&quot;Loop End&quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">3000</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20211229204847.png"></p>
<p>延迟圈转完后进行倒计时轮转，下面的进度条prg= 已过时长 / (延迟时长+回调时长)。</p>
<h2 id="逻辑定时器"><a href="#逻辑定时器" class="headerlink" title="逻辑定时器"></a>逻辑定时器</h2><p>逻辑定时器(基于定点数)，可以跑在服务器上，不依赖于Mono。</p>
<p>在本项目中，由 NetSvc.GetServiceMessageAndHandle(GameMsg msg) &gt; BattleSys.NotifyOpKey(GameMsg msg) &gt; FightMgr.Tick() &gt; MainLogicUnit.LogicTick() &gt; MainLogicUnit.TickSkill() &gt; <strong>LogicTimer.Tick()</strong> 驱动。</p>
<p>下面贴<strong>重要成员</strong>和使用的<strong>接口</strong>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对外接口(构造器)：</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LogicTimer</span>(<span class="params">Action cb, PEInt delayTime, <span class="built_in">int</span> loopTime = <span class="number">0</span></span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    delta = Configs.ServerLogicFrameIntervelMs;</span><br><span class="line">    IsActive = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重要成员：</span></span><br><span class="line"><span class="comment">// 服务端每一帧的时间(66ms)</span></span><br><span class="line">PEInt delta;</span><br><span class="line"><span class="comment">// 延迟时长</span></span><br><span class="line">PEInt delayTime;</span><br><span class="line"><span class="comment">// 循环周期时长</span></span><br><span class="line">PEInt loopTime;</span><br><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line">Action cb;</span><br></pre></td></tr></table></figure>



<h1 id="Buff"><a href="#Buff" class="headerlink" title="Buff"></a><Center>Buff<Center/></h1><p>贴一下核心属性和对应的Enum类。</p>
<h2 id="SubLogicUnit类：辅助类逻辑单元基类"><a href="#SubLogicUnit类：辅助类逻辑单元基类" class="headerlink" title="SubLogicUnit类：辅助类逻辑单元基类"></a>SubLogicUnit类：辅助类逻辑单元基类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 状态阶段</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> SubUnitState</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    Delay,</span><br><span class="line">    Start,</span><br><span class="line">    Tick,</span><br><span class="line">    End</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 辅助类逻辑单元基类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Buff and Bullet</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">SubLogicUnit</span> : <span class="title">LogicUnit</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//---------------1.核心属性：---------------</span></span><br><span class="line">    <span class="comment">// 来源角色</span></span><br><span class="line">    <span class="keyword">public</span> MainLogicUnit source;</span><br><span class="line">    <span class="comment">// 所属技能</span></span><br><span class="line">    <span class="keyword">protected</span> Skill skill;</span><br><span class="line">    <span class="comment">// 延迟生效时间</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> delayTime;</span><br><span class="line">    <span class="comment">// 辅助单元状态</span></span><br><span class="line">    <span class="keyword">public</span> SubUnitState unitState;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//---------------2.核心事件：---------------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicInit</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// if delayTime == 0 切换状态为Start</span></span><br><span class="line">        <span class="comment">// else 切换状态为Delay</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicTick</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (unitState)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> SubUnitState.Delay:</span><br><span class="line">                <span class="comment">// Delay完切换状态为Start</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SubUnitState.End:</span><br><span class="line">                End();</span><br><span class="line">                unitState = SubUnitState.None;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SubUnitState.None:</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUnInit</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Tick</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="BuffCfg类"><a href="#BuffCfg类" class="headerlink" title="BuffCfg类"></a>BuffCfg类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buff类型，用来创建不同类型的buff</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> BuffTypeEnum &#123;</span><br><span class="line">    None,</span><br><span class="line">    ModifySkill,</span><br><span class="line">    MoveSpeed_Single,<span class="comment">//单体加速buff</span></span><br><span class="line">    Silense,<span class="comment">//沉默</span></span><br><span class="line">    ArthurMark,<span class="comment">//Arthur1技能的标记伤害Buff</span></span><br><span class="line">    HPCure,<span class="comment">//治疗</span></span><br><span class="line">    MoveSpeed_DynamicGroup,<span class="comment">//Arthur1技能的动态群体移速Buff</span></span><br><span class="line">    MoveAttack,<span class="comment">//移动攻击</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buff位置确定方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> StaticPosTypeEnum &#123;</span><br><span class="line">    None,</span><br><span class="line">    SkillCasterPos,<span class="comment">//Buff所属技能施放者的位置</span></span><br><span class="line">    SkillLockTargetPos,<span class="comment">//Buff所属技能锁定目标的位置</span></span><br><span class="line">    BulletHitTargetPos,<span class="comment">//子弹命中目标的位置</span></span><br><span class="line">    UIInputPos,<span class="comment">//UI输入位置信息，比如后裔2技能</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buff附着目标</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> AttachTypeEnum &#123;</span><br><span class="line">    None,</span><br><span class="line">    Caster,<span class="comment">//由施术者自己确定：给自己，Arthur的1技能加速buff</span></span><br><span class="line">    Indie,<span class="comment">//由施术者自己确定：区域，Arthur大招(位置固定)产生的持续范围伤害</span></span><br><span class="line">    </span><br><span class="line">    Target,<span class="comment">//由受击者确定：给目标，Arthur的1技能沉默buff</span></span><br><span class="line">    Bullet,<span class="comment">//由受击者确定：Houyi大招命中(位置动态)目标时产生的范围伤害</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BuffCfg</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ------------属性------------</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> buffId;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> buffName;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ⭐buff类型，用来创建不同类型的buff</span></span><br><span class="line">    <span class="keyword">public</span> BuffTypeEnum buffType;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ⭐buff附着目标</span></span><br><span class="line">    <span class="keyword">public</span> AttachTypeEnum attacher;</span><br><span class="line">    <span class="keyword">public</span> StaticPosTypeEnum staticPosType;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// buff作用目标，如果为null默认影响附着对象</span></span><br><span class="line">    <span class="keyword">public</span> TargetCfg impacter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------效果相关------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> buffDelay;</span><br><span class="line">    <span class="comment">// ⭐buff效果触发频率(比如持续1秒1次) </span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> buffInterval;</span><br><span class="line">    <span class="comment">// ⭐buff持续时间（不包含delay）0：生效1次，-1：永久生效</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> buffDuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------配置------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> buffAudio;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> buffEffect;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> hitTickAudio;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Buff类"><a href="#Buff类" class="headerlink" title="Buff类"></a>Buff类</h2><p>使用关系：</p>
<p>正常一种类得buff有 <code>xxBuff类 and xxBuffCfg类</code>，xxBuffCfg拥有该buff特有的属性，xxBuff会包含xxBuffCfg在初期化通过ResSvc加载获取它。</p>
<p>继承关系：</p>
<ul>
<li>xxBuff &lt; Buff &lt; SubLogicUnit &lt; LogicUnit</li>
<li>xxBuffCfg &lt; BuffCfg</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Buff</span> : <span class="title">SubLogicUnit</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> buff附着单位</span></span><br><span class="line">    <span class="keyword">public</span> MainLogicUnit owner;</span><br><span class="line">    <span class="keyword">public</span> BuffCfg cfg;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> buffId;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">object</span>[] args;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 群体buff作用目标列表</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;MainLogicUnit&gt; targetList;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        cfg = ResSvc.Instance().GetBuffConfigById(buffId);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">base</span>.LogicInit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicTick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.LogicTick();</span><br><span class="line">        <span class="keyword">switch</span>(unitState) &#123;</span><br><span class="line">            <span class="keyword">case</span> SubUnitState.Start:</span><br><span class="line">                Start();</span><br><span class="line">                <span class="comment">// buffDuration: buff持续时间（不包含delay）0：生效1次，-1：永久生效</span></span><br><span class="line">                <span class="comment">// 根据buffDuration来切换状态，永久or循环的切换到Tick，生效1次得直接进入End状态</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SubUnitState.Tick:</span><br><span class="line">                <span class="comment">// 频率触发型buff需要按照频率来Tick，比如点燃</span></span><br><span class="line">                <span class="keyword">if</span>(cfg.buffInterval &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    tickCount += Configs.ServerLogicFrameIntervelMs;</span><br><span class="line">                    <span class="keyword">if</span>(tickCount &gt;= cfg.buffInterval) &#123;</span><br><span class="line">                        tickCount -= cfg.buffInterval;</span><br><span class="line">                        Tick();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                 <span class="comment">// 根据服务器所规定得逻辑帧得时长，来进行每一次循环得时长计算</span></span><br><span class="line">                durationCount += Configs.ServerLogicFrameIntervelMs;</span><br><span class="line">                <span class="keyword">if</span>(durationCount &gt;= buffDuration &amp;&amp; buffDuration != <span class="number">-1</span>) &#123;</span><br><span class="line">                    unitState = SubUnitState.End;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Tick</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="用于替换技能的特别buff"><a href="#用于替换技能的特别buff" class="headerlink" title="用于替换技能的特别buff"></a>用于替换技能的特别buff</h2><p>前面提到的亚瑟技能1实现得具体buff，进行技能之间的替换</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonModifySkillBuffCfg</span> : <span class="title">BuffCfg</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> originalID;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> replaceID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonModifySkillBuff</span> : <span class="title">Buff</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> originalID;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> replaceID;</span><br><span class="line">    <span class="keyword">private</span> Skill modifySkill;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.LogicInit();</span><br><span class="line">        <span class="comment">// Cfg给originalID、replaceID赋值，owner.SkillArr找到对应技能给modifySkill赋值</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.Start();</span><br><span class="line">        <span class="comment">// 开始时替换</span></span><br><span class="line">        modifySkill.ReplaceSkillCfg(replaceID);</span><br><span class="line">        modifySkill.SpellSuccCallback += ReplaceSkillReleaseDone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReplaceSkillReleaseDone</span>(<span class="params">Skill skillReleased</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(skillReleased.cfg.isNormalAttack) &#123;</span><br><span class="line">            unitState = SubUnitState.End;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 情况1.如果上次成功释放普攻就会被Skill.SpellSuccCallback()调用到这里</span></span><br><span class="line">    <span class="comment">// 情况2.如果buff时间过了，会在Buff.LogicTick()中得计时结束进入End状态被调用到这里</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.End();</span><br><span class="line">        <span class="comment">// 结束时替换回来</span></span><br><span class="line">        modifySkill.ReplaceSkillCfg(originalID);</span><br><span class="line">        modifySkill.SpellSuccCallback -= ReplaceSkillReleaseDone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技能替换得接口：</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Skill</span>&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 技能替换，其实就是把Skill构造时做的事重做一遍</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReplaceSkillCfg</span>(<span class="params"><span class="built_in">int</span> replaceId</span>)</span> &#123;</span><br><span class="line">        skillCfg = ResSvc.Instance().GetSkillConfigById(replaceId);</span><br><span class="line">        spellTime = skillCfg.spellTime;</span><br><span class="line">        skillTime = skillCfg.skillTime;</span><br><span class="line">        <span class="keyword">if</span>(skillCfg.isNormalAttack) &#123;</span><br><span class="line">            owner.InitAttackSpeedRate(<span class="number">1000</span> / skillTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="人物状态：沉默、眩晕、击飞"><a href="#人物状态：沉默、眩晕、击飞" class="headerlink" title="人物状态：沉默、眩晕、击飞"></a>人物状态：沉默、眩晕、击飞</h2><p>比如亚瑟1技能的沉默，技能是附加了沉默buff，buff那块只要对 英雄/小兵 脚本的对应字段进行改变就行了：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 单体沉默buff：亚瑟技能1附带的buff</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SilenseBuff_Single</span>: <span class="title">Buff</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.Start();</span><br><span class="line">        owner.SilenceCount += <span class="number">1</span>;<span class="comment">//1秒沉默</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.End();</span><br><span class="line">        owner.SilenceCount -= <span class="number">1</span>;<span class="comment">//buff.duration字段设置了为1秒，所以1秒后会执行这句，沉默期结束</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的 英雄/小兵 的接口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> MainLogicAttributes</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainLogicUnit</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// -------------沉默：沉默时无法施放技能-------------</span></span><br><span class="line">    <span class="built_in">int</span> silenceCount;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> SilenceCount &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> silenceCount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            silenceCount = <span class="keyword">value</span>;</span><br><span class="line">            <span class="keyword">if</span>(IsSilenced()) &#123;</span><br><span class="line">                <span class="comment">// 1.进入沉默状态并触发OnStateChange</span></span><br><span class="line">                OnStateChange?.Invoke(StateEnum.Silenced, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                OnStateChange?.Invoke(StateEnum.Silenced, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">IsSilenced</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> silenceCount != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面的接口是 OnStateChange += UpdateState，看下UpdateState代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainViewUnit</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateState</span>(<span class="params">StateEnum state, <span class="built_in">bool</span> show</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(state == StateEnum.Knockup</span><br><span class="line">           || state == StateEnum.Silenced</span><br><span class="line">           || state == StateEnum.Silenced) &#123;</span><br><span class="line">            <span class="keyword">if</span>(mainLogicUnit.IsPlayerSelf() &amp;&amp; show) &#123;</span><br><span class="line">                playWindow.SetAllSkillForbidState();<span class="comment">// 禁止所有技能的点击</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hpWindow.SetStateInfo(mainLogicUnit, state, show);<span class="comment">// 在ui血条上显示状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="为目标标记上受击标记"><a href="#为目标标记上受击标记" class="headerlink" title="为目标标记上受击标记"></a>为目标标记上受击标记</h2><p>其实就是MarkBuff，类似于亚瑟技能1的标记buff：标记目标，持续5秒，技能和普攻会对标记目标可额外造成目标最大生命1%的伤害。</p>
<p>使用对<strong>Onhurt事件</strong>委托链添加委托实现。</p>
<p>调用回溯：from serive &gt; InputKey() &gt; MainLogicSkill.InputSkillKey() &gt;Skill.ReleaseSkill() &gt; Skill.CalcSkillAttack() &gt; Skill.HitTarget() &gt;target.CreateSkillBuff() &gt; ArthurMarkBuff new()</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ArthurMarkBuffCfg</span> : <span class="title">BuffCfg</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> damagePct;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ArthurMarkBuff</span> : <span class="title">Buff</span></span><br><span class="line">&#123;</span><br><span class="line">    PEInt damagePct;</span><br><span class="line">    MainLogicUnit target;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.LogicInit();</span><br><span class="line"></span><br><span class="line">        ArthurMarkBuffCfg ambc = cfg <span class="keyword">as</span> ArthurMarkBuffCfg;</span><br><span class="line">        damagePct = ambc.damagePct;</span><br><span class="line">        target = skill.lockTarget; <span class="comment">// 为target赋值</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.Start();</span><br><span class="line">        target.OnHurt += GetHurt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetHurt</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        target.GetDamageByBuff(damagePct / <span class="number">100</span> * target.ud.unitCfg.hp, <span class="keyword">this</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.End();</span><br><span class="line">        target.OnHurt -= GetHurt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="为目标标记一个立场标记，友军群体加速"><a href="#为目标标记一个立场标记，友军群体加速" class="headerlink" title="为目标标记一个立场标记，友军群体加速"></a>为目标标记一个立场标记，友军群体加速</h2><p>亚瑟技能1标记，会让附近 range&lt;5f 的友军会增加10%的移速。这像是一个立场，需要按照服务端的逻辑帧逐帧计算敌人是否在范围内从而为其加速。</p>
<p>核心是维护一个targetList：使用类似于前面写的<strong>通用的寻找目标实现</strong>查找算法，逐帧计算附近 range&lt;5f 的对象，将其加入到targetList队列中。</p>
<p>下面对Buff整体生命流程中，仅对于核心targetList的处理与使用进行展示：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveSpeedBuff_DynamicGroup</span>: <span class="title">Buff</span> &#123;</span><br><span class="line">    <span class="comment">// 设定的buff加速量，亚瑟技能1标记buff为10%</span></span><br><span class="line">    <span class="keyword">private</span> PEInt speedOffset;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        targetList = <span class="keyword">new</span> List&lt;MainLogicUnit&gt;();</span><br><span class="line">        targetList.AddRange(CalcRule.FindMulipleTargetByRule(owner, cfg.impacter, skill.skillArgs)); <span class="comment">// 开始时计算目标队列</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        ModifyTargetsMoveSpeed(speedOffset, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Tick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        ModifyTargetsMoveSpeed(-speedOffset);</span><br><span class="line"></span><br><span class="line">        targetList.Clear();</span><br><span class="line">        targetList.AddRange(CalcRule.FindMulipleTargetByRule(owner, cfg.impacter, PEVector3.zero)); <span class="comment">// 逐帧计算目标队列</span></span><br><span class="line">        ModifyTargetsMoveSpeed(speedOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">End</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        ModifyTargetsMoveSpeed(-speedOffset);</span><br><span class="line">        targetList.Clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ModifyTargetsMoveSpeed</span>(<span class="params">PEInt <span class="keyword">value</span>, <span class="built_in">bool</span> showJump = <span class="literal">false</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// targetList =&gt; Move speed up</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自动寻找目标攻击的通用buff"><a href="#自动寻找目标攻击的通用buff" class="headerlink" title="自动寻找目标攻击的通用buff"></a>自动寻找目标攻击的通用buff</h2><p>实现功能示意图：</p>
<p><img src="C:\Users\YAN\AppData\Roaming\Typora\typora-user-images\image-20220104233959056.png" alt="image-20220104233959056"></p>
<p>部分代码演示：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Buff配置</span></span><br><span class="line"><span class="keyword">var</span> MoveAttackBuff = <span class="keyword">new</span> BuffCfg()  &#123;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//通用buff属性</span></span><br><span class="line">    buffId = <span class="number">999999</span>,</span><br><span class="line">    buffName = <span class="string">&quot;移动攻击&quot;</span>,</span><br><span class="line">    buffType = BuffTypeEnum.MoveAttack,</span><br><span class="line"></span><br><span class="line">    attacher = AttachTypeEnum.Caster,<span class="comment">// buff附着给自己</span></span><br><span class="line">    impacter = <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    buffDelay = <span class="number">0</span>,</span><br><span class="line">    buffInterval = <span class="number">66</span>,<span class="comment">// 1帧检测1次</span></span><br><span class="line">    buffDuration = <span class="number">5000</span>,<span class="comment">// 单次持续时间</span></span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="comment">// Buff逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveAttackBuff</span>: <span class="title">Buff</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查找算法示意图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220104231802.png"></p>
<h2 id="后裔的被动技能"><a href="#后裔的被动技能" class="headerlink" title="后裔的被动技能"></a>后裔的被动技能</h2><p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220112225127.png"></p>
<h3 id="普攻成功后增加攻速"><a href="#普攻成功后增加攻速" class="headerlink" title="普攻成功后增加攻速"></a>普攻成功后增加攻速</h3><p>后裔被动，每次平砍增加5%攻速，最高3次，持续3秒。如果释放2、3技能（1技能强化普攻可以）就直接失效。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HouyiPasvAttackSpeedBuffCfg</span> : <span class="title">BuffCfg</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> overCount;<span class="comment">// 叠加层数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speedAddtion;<span class="comment">// 加成百分比</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> resetTime;<span class="comment">// 重置周期</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>buff代码就不贴了，具体逻辑是 buff类 给技能释放成功的回调注册一个事件，事件实现技能效果。</p>
<h3 id="普攻3次后变成3连击"><a href="#普攻3次后变成3连击" class="headerlink" title="普攻3次后变成3连击"></a>普攻3次后变成3连击</h3><p>由于技能会跳转（如图），所以不能使用前面制作的替换技能buff，那个太简单了。</p>
<h1 id="Bullet"><a href="#Bullet" class="headerlink" title="Bullet"></a><Center>Bullet<Center/></h1><h2 id="SweepVolume-体积扫描检测"><a href="#SweepVolume-体积扫描检测" class="headerlink" title="SweepVolume 体积扫描检测"></a>SweepVolume 体积扫描检测</h2><p>用于逻辑帧计算子弹是否命中用的。记录上一帧的位置，与这一帧的位置连线，它的轨迹是一个矩形（粉色），查看矩形是否穿过目标碰撞体（蓝色），也就是矩形与圆形求相交的问题。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220111220103.png"></p>
<ol>
<li>计算 AB中点位置 = (LogicPos + lastPos) / 2</li>
<li>计算 向量A-&gt;B = LogicPos - lastPos</li>
<li>由1与2模拟出 矩形碰撞体PEBoxCollider</li>
<li>由3创建出的矩形，与目标的 圆形碰撞体PECylinderCollider 进行</li>
</ol>
<p>具体怎么创建碰撞体，是自制的定点数物理碰撞计算库，在其他文章中详解。</p>
<h3 id="Debug-弹道显示方案"><a href="#Debug-弹道显示方案" class="headerlink" title="Debug 弹道显示方案"></a>Debug 弹道显示方案</h3><p>想要debug看到弹道规矩，可以在每一个Tick里创建一个Cube模拟矩形，也就是子弹轨迹。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220112000119.png"></p>
<h2 id="子弹Config"><a href="#子弹Config" class="headerlink" title="子弹Config"></a>子弹Config</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BulletCfg</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> BulletTypeEnum bulletType;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> bulletName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resPath;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> bulletSpeed;<span class="comment">//运算时转换为PEInt</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> bulletSize;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> bulletHeight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> bulletOffset;<span class="comment">//画面表现用的偏移值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> bulletDelay;<span class="comment">//释放延迟 ms</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> canBlock;<span class="comment">//技能是否不能穿透</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TargetCfg impacter;<span class="comment">//目标类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> bulletDuration;<span class="comment">//持续时间(不含bulletDelay)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> BulletTypeEnum &#123;</span><br><span class="line">    UIDirection,<span class="comment">//ui指定方向</span></span><br><span class="line">    UIPosition,<span class="comment">//ui指定位置</span></span><br><span class="line">    SkillTarget,<span class="comment">//当前技能目标(锁定目标技能)</span></span><br><span class="line">    BuffSearch,<span class="comment">//靠近物体自动寻找</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="实现子弹曲线"><a href="#实现子弹曲线" class="headerlink" title="实现子弹曲线"></a><Center>实现子弹曲线<Center/></h1><h2 id="图像分解"><a href="#图像分解" class="headerlink" title="图像分解"></a>图像分解</h2><p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220115100853.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/20220115101025.png"></p>
<p>![image-20220115105710617](C:\Users\YAN JUNJIE\AppData\Roaming\Typora\typora-user-images\image-20220115105710617.png)</p>
<h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>我 -&gt; 目标 连线的向量，是最初的弹道向量，也就是一开始的红色向量。</p>
<p>对 最初的弹道向量 + 我的中心点，可以取出一个唯一的<strong>垂直平面</strong>，对这个垂直平面上，以我的中心点为起始点，任取一个<strong>模（偏移量）</strong>数值随机的向量，作为偏移向量，也就是绿箭头。</p>
<p>绿箭头的模确定后就不再改变，持续施加，称作<strong>固定值影响向量</strong>。</p>
<p>而红色向量始终指向目标，所以会不停改变方向，称作<strong>方向矫正向量</strong>。</p>
<p>最终，使用 固定值影响向量、方向矫正向量 的向量之和，也就是某个时间点下<strong>子弹的方向向量</strong>了。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>实际就并不取用这么复杂过程了。</p>
<h3 id="①-固定值影响向量"><a href="#①-固定值影响向量" class="headerlink" title="① 固定值影响向量"></a>① 固定值影响向量</h3><p>取 我-&gt;目标 的向量 + 我的up方向向量 的叉乘<strong>Cross</strong>向量，然后规格化，就得到了准确的方向向量。</p>
<p>想要往上，只要对结果添加up方向上的向量就可以。当然，这需要一个随机数。</p>
<h4 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h4><p>因为同步问题，不能只使用随机，所以通过<strong>传播随机种子</strong>来确定性地随机，让多个端末都能正确计算出同样的效果。</p>
<p>然后再偷个懒，种子也不传播了，固定666。</p>
<h1 id="Bug-amp-QA"><a href="#Bug-amp-QA" class="headerlink" title="Bug &amp; QA"></a><Center>Bug &amp; QA<Center/></h1><h2 id="移动攻击Bugs"><a href="#移动攻击Bugs" class="headerlink" title="移动攻击Bugs"></a>移动攻击Bugs</h2><p>1.<strong>攻击动画没播放</strong>是因为移动攻击时方向变更，导致动画状态立即恢复“free”从而导致攻击动画被跳过了。</p>
<p>解决方案是方向变更时，将<strong>是否在技能前摇</strong>flag一起加入判定条件，来决定是否变化动画。</p>
<p>2.<strong>人物朝向没变化</strong>也是因为方向被UI输入朝向重制了，关键是看ViewUnit.viewTargetDir属性。</p>
<p>解决方案一样，将<strong>是否在技能前摇</strong>flag作为判定条件来决定是否根据UI改变朝向。</p>
<p>3.<strong>移动攻击时会滑动</strong>是因为UI输入方向被服务端传来的最新UI移动请求给覆盖了，关键看MainLogic.InputDir属性。</p>
<p>解决方案是在接收到服务端传来的最新UI移动请求时，进行<strong>是否在技能前摇、是否被控制</strong>flag作为判定条件来决定是否改变InputDir。</p>
<p>4.<strong>移动攻击完会僵直平移一段距离</strong>是因为技能前摇时有一个定时器，根据技能总时长来将角色设回“free”动画。</p>
<p>解决方案是在收到服务器逻辑方向改变请求改变LogicUnit.LogicDir属性时，将过去的定时器动画Callback都清除掉。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">CodingCodingK</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://codingcodingk.github.io/2021/12/18/Project/Unity/Moba/HOK/skill/">https://codingcodingk.github.io/2021/12/18/Project/Unity/Moba/HOK/skill/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://CodingCodingK.github.io" target="_blank">CodingCodingK Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Unity/">Unity</a><a class="post-meta__tags" href="/tags/%E5%B7%A5%E7%A8%8B/">工程</a><a class="post-meta__tags" href="/tags/Moba/">Moba</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/18/Tech/CSharp/CLR-Via-CSharp/cp5/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/clr-via-csharp.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CLR Via C#个人笔记5 - 基本类型</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/27/Tech/CSharp/Essence/stack/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C#精要 - 堆栈篇</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/27/Project/Unity/Moba/HOK/chara/" title="王者荣耀复刻项目 模型控制篇"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-27</div><div class="title">王者荣耀复刻项目 模型控制篇</div></div></a></div><div><a href="/2022/02/19/Project/Unity/Moba/HOK/bag/" title="王者荣耀复刻项目 背包系统篇"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-19</div><div class="title">王者荣耀复刻项目 背包系统篇</div></div></a></div><div><a href="/2021/11/20/Project/Unity/Moba/HOK/fight/" title="王者荣耀复刻项目 战斗篇"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="title">王者荣耀复刻项目 战斗篇</div></div></a></div><div><a href="/2022/03/04/Project/Unity/Moba/HOK/skilleditor/" title="王者荣耀复刻项目 技能编辑器篇"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-04</div><div class="title">王者荣耀复刻项目 技能编辑器篇</div></div></a></div><div><a href="/2021/11/06/Project/Unity/Moba/HOK/intro/" title="王者荣耀复刻项目 序言"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-06</div><div class="title">王者荣耀复刻项目 序言</div></div></a></div><div><a href="/2021/11/20/Project/Unity/Moba/HOK/netSyn/" title="王者荣耀复刻项目 网络同步篇"><img class="cover" src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/hok.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="title">王者荣耀复刻项目 网络同步篇</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/Seed_profile.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">CodingCodingK</div><div class="author-info__description">一个正在成为游戏开发者的人</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/CodingCodingK"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/CodingCodingK" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">2022年的目标是：ET框架 + 烟雨Moba | linux系统学习 + c++重温</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">技能机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E8%A7%88%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">总览图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">技能分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%9B%AE%E6%A0%87%E6%8A%80%E8%83%BD%EF%BC%88%E9%9D%9E%E6%8C%87%E5%90%91%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">非目标技能（非指向）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-buff%E6%9B%BF%E6%8D%A2%E6%99%AE%E6%94%BBCfg%E6%8A%80%E8%83%BD%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%BA%9A%E7%91%9F%E4%B8%80%E6%8A%80%E8%83%BD%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.buff替换普攻Cfg技能实现（亚瑟一技能）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%8E%E8%A3%94%E4%B8%89%E6%8A%80%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.后裔三技能实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E6%8A%80%E8%83%BD%EF%BC%88%E6%8C%87%E5%90%91%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">目标技能（指向）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%9A%84%E5%AF%BB%E6%89%BE%E7%9B%AE%E6%A0%87%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text">通用的寻找目标实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BA%9A%E7%91%9F%E6%99%AE%E6%94%BB%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.亚瑟普攻实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%8E%E8%A3%94%E6%99%AE%E6%94%BB%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.3.</span> <span class="toc-text">2.后裔普攻实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E6%9E%84%E9%80%A0"><span class="toc-number">2.</span> <span class="toc-text">技能构造</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E8%83%BDConfig"><span class="toc-number">2.1.</span> <span class="toc-text">技能Config</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%80%E6%9D%A1%E5%92%8C%E4%BC%A4%E5%AE%B3UI"><span class="toc-number">3.</span> <span class="toc-text">血条和伤害UI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%80%E6%9D%A1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">血条 数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI%E6%98%A0%E5%B0%84"><span class="toc-number">3.2.</span> <span class="toc-text">UI映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A4%E5%AE%B3%E9%A3%98%E5%AD%97-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.</span> <span class="toc-text">伤害飘字 数据结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%8A%80%E8%83%BD%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">通用技能定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">总体流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">定时器代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%99%A8%E6%B5%8B%E8%AF%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">定时器测试示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">4.4.</span> <span class="toc-text">逻辑定时器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Buff"><span class="toc-number">5.</span> <span class="toc-text">Buff</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SubLogicUnit%E7%B1%BB%EF%BC%9A%E8%BE%85%E5%8A%A9%E7%B1%BB%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83%E5%9F%BA%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">SubLogicUnit类：辅助类逻辑单元基类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BuffCfg%E7%B1%BB"><span class="toc-number">5.2.</span> <span class="toc-text">BuffCfg类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Buff%E7%B1%BB"><span class="toc-number">5.3.</span> <span class="toc-text">Buff类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E6%9B%BF%E6%8D%A2%E6%8A%80%E8%83%BD%E7%9A%84%E7%89%B9%E5%88%ABbuff"><span class="toc-number">5.4.</span> <span class="toc-text">用于替换技能的特别buff</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%BA%E7%89%A9%E7%8A%B6%E6%80%81%EF%BC%9A%E6%B2%89%E9%BB%98%E3%80%81%E7%9C%A9%E6%99%95%E3%80%81%E5%87%BB%E9%A3%9E"><span class="toc-number">5.5.</span> <span class="toc-text">人物状态：沉默、眩晕、击飞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E7%9B%AE%E6%A0%87%E6%A0%87%E8%AE%B0%E4%B8%8A%E5%8F%97%E5%87%BB%E6%A0%87%E8%AE%B0"><span class="toc-number">5.6.</span> <span class="toc-text">为目标标记上受击标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E7%9B%AE%E6%A0%87%E6%A0%87%E8%AE%B0%E4%B8%80%E4%B8%AA%E7%AB%8B%E5%9C%BA%E6%A0%87%E8%AE%B0%EF%BC%8C%E5%8F%8B%E5%86%9B%E7%BE%A4%E4%BD%93%E5%8A%A0%E9%80%9F"><span class="toc-number">5.7.</span> <span class="toc-text">为目标标记一个立场标记，友军群体加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%AF%BB%E6%89%BE%E7%9B%AE%E6%A0%87%E6%94%BB%E5%87%BB%E7%9A%84%E9%80%9A%E7%94%A8buff"><span class="toc-number">5.8.</span> <span class="toc-text">自动寻找目标攻击的通用buff</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%A3%94%E7%9A%84%E8%A2%AB%E5%8A%A8%E6%8A%80%E8%83%BD"><span class="toc-number">5.9.</span> <span class="toc-text">后裔的被动技能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E6%94%BB%E6%88%90%E5%8A%9F%E5%90%8E%E5%A2%9E%E5%8A%A0%E6%94%BB%E9%80%9F"><span class="toc-number">5.9.1.</span> <span class="toc-text">普攻成功后增加攻速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E6%94%BB3%E6%AC%A1%E5%90%8E%E5%8F%98%E6%88%903%E8%BF%9E%E5%87%BB"><span class="toc-number">5.9.2.</span> <span class="toc-text">普攻3次后变成3连击</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bullet"><span class="toc-number">6.</span> <span class="toc-text">Bullet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SweepVolume-%E4%BD%93%E7%A7%AF%E6%89%AB%E6%8F%8F%E6%A3%80%E6%B5%8B"><span class="toc-number">6.1.</span> <span class="toc-text">SweepVolume 体积扫描检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-%E5%BC%B9%E9%81%93%E6%98%BE%E7%A4%BA%E6%96%B9%E6%A1%88"><span class="toc-number">6.1.1.</span> <span class="toc-text">Debug 弹道显示方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E5%BC%B9Config"><span class="toc-number">6.2.</span> <span class="toc-text">子弹Config</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AD%90%E5%BC%B9%E6%9B%B2%E7%BA%BF"><span class="toc-number">7.</span> <span class="toc-text">实现子弹曲线</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%88%86%E8%A7%A3"><span class="toc-number">7.1.</span> <span class="toc-text">图像分解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3"><span class="toc-number">7.2.</span> <span class="toc-text">理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0-%E5%9B%BA%E5%AE%9A%E5%80%BC%E5%BD%B1%E5%93%8D%E5%90%91%E9%87%8F"><span class="toc-number">7.3.1.</span> <span class="toc-text">① 固定值影响向量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">7.3.1.1.</span> <span class="toc-text">随机数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bug-amp-QA"><span class="toc-number">8.</span> <span class="toc-text">Bug &amp; QA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E6%94%BB%E5%87%BBBugs"><span class="toc-number">8.1.</span> <span class="toc-text">移动攻击Bugs</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/04/Tech/Game/uiboy_4/" title="Unity编辑器拓展"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity编辑器拓展"/></a><div class="content"><a class="title" href="/2022/03/04/Tech/Game/uiboy_4/" title="Unity编辑器拓展">Unity编辑器拓展</a><time datetime="2022-03-04T14:13:03.128Z" title="发表于 2022-03-04 22:13:03">2022-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/04/Tech/Game/uiboy_3/" title="Unity生命流程"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity生命流程"/></a><div class="content"><a class="title" href="/2022/03/04/Tech/Game/uiboy_3/" title="Unity生命流程">Unity生命流程</a><time datetime="2022-03-04T14:13:03.127Z" title="发表于 2022-03-04 22:13:03">2022-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/04/Tech/CSharp/Essence/thread/" title="C#精要 - 线程篇"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C#精要 - 线程篇"/></a><div class="content"><a class="title" href="/2022/03/04/Tech/CSharp/Essence/thread/" title="C#精要 - 线程篇">C#精要 - 线程篇</a><time datetime="2022-03-04T14:13:03.121Z" title="发表于 2022-03-04 22:13:03">2022-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/04/Tech/CSharp/Essence/method/" title="C#精要 - 类内成员篇"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C#精要 - 类内成员篇"/></a><div class="content"><a class="title" href="/2022/03/04/Tech/CSharp/Essence/method/" title="C#精要 - 类内成员篇">C#精要 - 类内成员篇</a><time datetime="2022-03-04T14:13:03.120Z" title="发表于 2022-03-04 22:13:03">2022-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/04/Tech/CSharp/Essence/gc/" title="C#精要 - GC篇"><img src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io.ImageHost/img/bg5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C#精要 - GC篇"/></a><div class="content"><a class="title" href="/2022/03/04/Tech/CSharp/Essence/gc/" title="C#精要 - GC篇">C#精要 - GC篇</a><time datetime="2022-03-04T14:13:03.119Z" title="发表于 2022-03-04 22:13:03">2022-03-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022  <i id="heartbeat" class="fa fas fa-heartbeat"></i> CodingCodingK</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script data-pjax defer src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io/js/chocolate.js"></script><script data-pjax defer src="https://cdn.jsdelivr.net/gh/CodingCodingK/CodingCodingK.github.io/js/cursor.js"></script><script src="/live2d-widget/autoload.js"></script><script src="/js/mine.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?CodingCodingK";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="CodingCodingK";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>